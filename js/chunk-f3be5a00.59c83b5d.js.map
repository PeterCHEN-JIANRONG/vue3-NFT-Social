{"version":3,"sources":["webpack:///./src/views/FrontEnd/SendPost.vue?f032","webpack:///./src/views/FrontEnd/SendPost.vue","webpack:///./src/views/FrontEnd/SendPost.vue?264f","webpack:///./src/components/TittleBlock.vue","webpack:///./src/components/TittleBlock.vue?aeb8"],"names":["router","useRouter","axios","inject","Swal","isLoading","ref","form","content","images","userStore","useUserStore","postSuccess","title","text","path","fire","position","icon","showConfirmButton","timer","then","push","createPost","value","length","errorAlertConstruct","data","user","_id","image","tags","type","url","process","post","reset","catch","err","console","log","formFiles","uploading","uploadImages","files","formData","FormData","i","file","append","headers","res","response","message","__exports__"],"mappings":"gHAAA,W,0yBCyEA,IAAMA,EAASC,iBACTC,EAAQC,oBAAO,SACfC,EAAOD,oBAAO,SACdE,EAAYC,kBAAI,GAChBC,EAAOD,iBAAI,MACXE,EAAUF,iBAAI,IACdG,EAASH,iBAAI,IAEbI,EAAYC,iBAGZC,EAAc,SAACC,EAAOC,EAAMC,GAChCX,EAAKY,KAAK,CACRC,SAAU,SACVC,KAAM,UACNL,QACAC,OACAK,mBAAmB,EACnBC,MAAO,OACNC,MAAK,WACNrB,EAAOsB,KAAKP,OAIVQ,EAAa,WACjB,GAAId,EAAOe,MAAMC,OAAS,EACxBrB,EAAKY,KAAKU,iCAAoB,KAAM,yBADtC,CAKA,IAAMC,EAAO,CACXC,KAAMlB,EAAUkB,KAAKC,IACrBrB,QAASA,EAAQgB,MACjBM,MAAOrB,EAAOe,MACdO,KAAM,CAAC,KAAM,SACbC,KAAM,UAEFC,EAAM,GAAH,OAAMC,yCAAN,SACT7B,EAAUmB,OAAQ,EAClBtB,EACGiC,KAAKF,EAAKN,GACVN,MAAK,WACJd,EAAKiB,MAAMY,QACX/B,EAAUmB,OAAQ,EAClBZ,EAAY,KAAM,OAAQ,QAE3ByB,OAAM,SAACC,GACNC,QAAQC,IAAIF,QAKZG,EAAYnC,iBAAI,MAChBoC,EAAYpC,kBAAI,GAChBqC,EAAe,WAEnB,GAAqC,IAAjCF,EAAUjB,MAAMoB,MAAMnB,OAA1B,CAIA,GAAIgB,EAAUjB,MAAMoB,MAAMnB,OAAS,EAGjC,OAFArB,EAAKY,KAAKU,iCAAoB,KAAM,0BACpCnB,EAAKiB,MAAMY,QAKb,IADA,IAAMS,EAAW,IAAIC,SACZC,EAAI,EAAGA,EAAIN,EAAUjB,MAAMoB,MAAMnB,OAAQsB,GAAK,EAAG,CACxD,IAAMC,EAAOP,EAAUjB,MAAMoB,MAAMG,GACnCF,EAASI,OAAO,SAAUD,GAG5B,IAAMf,EAAM,GAAH,OAAMC,yCAAN,kBACHgB,EAAU,CACd,eAAgB,uBAElBR,EAAUlB,OAAQ,EAClBtB,EACGiC,KAAKF,EAAKY,EAAU,CAAEK,YACtB7B,MAAK,SAAC8B,GACLT,EAAUlB,OAAQ,EAClBf,EAAOe,MAAP,yBAAmBf,EAAOe,OAA1B,eAAoC2B,EAAIxB,KAAKA,UAE9CU,OAAM,SAACC,GACNI,EAAUlB,OAAQ,EAClBpB,EAAKY,KAAKU,iCAAoB,KAAMY,EAAIc,SAASzB,KAAK0B,e,stECxJ5D,MAAMC,EAA2B,IAAgB,EAAQ,CAAC,CAAC,YAAY,qBAExD,gB,kaCFf,MAAMA,EAA2B,IAAgB,EAAQ,CAAC,CAAC,YAAY,qBAExD,U,yDCRf,W","file":"js/chunk-f3be5a00.59c83b5d.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--1-1!./SendPost.vue?vue&type=style&index=0&id=67470892&lang=scss&scoped=true\"","<template>\n  <Loading :active=\"isLoading\" :z-index=\"1060\" />\n  <TittleBlock tittle=\"張貼動態\" />\n  <form\n    ref=\"form\"\n    class=\"shadow__post bg-white border border-2 border-dark p-5 mb-5\"\n    @submit.prevent=\"createPost\"\n  >\n    <div class=\"mb-3\">\n      <label for=\"content\" class=\"form-label\">貼文內容</label>\n      <textarea\n        class=\"form-control border border-2 border-dark\"\n        id=\"content\"\n        rows=\"4\"\n        v-model=\"content\"\n      ></textarea>\n    </div>\n    <div class=\"mb-5\">\n      <label for=\"formFiles\" class=\"form-label\"\n        >上傳圖片\n        <span\n          v-show=\"uploading\"\n          class=\"spinner-border spinner-border-sm\"\n          role=\"status\"\n        ></span>\n      </label>\n      <input\n        type=\"file\"\n        id=\"formFiles\"\n        class=\"form-control mb-2\"\n        ref=\"formFiles\"\n        @change=\"uploadImages\"\n        multiple\n      />\n      <div\n        v-if=\"images.length > 0\"\n        class=\"row g-2\"\n        :class=\"{ 'row-cols-2': images.length > 1 }\"\n      >\n        <div class=\"col\" v-for=\"(item, index) in images\" :key=\"item\">\n          <div class=\"image__card position-relative\">\n            <img :src=\"item\" class=\"w-100 h-15s img-cover\" />\n            <span\n              class=\"image__delete position-absolute top-0 end-0 m-2 fs-6 badge bg-light text-dark cursor-pointer\"\n              @click=\"images.splice(index, 1)\"\n              >刪除</span\n            >\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"text-center\">\n      <div class=\"mb-2\" v-if=\"images.length > 8\">\n        <span class=\"fs-6 text-danger\">上傳圖片超過 8 張，請刪除圖片</span>\n      </div>\n      <button\n        type=\"submit\"\n        class=\"btn btn-secondary w-50 border border-2 border-dark rounded-3\"\n        :disabled=\"images.length > 8 || uploading\"\n      >\n        送出貼文\n      </button>\n    </div>\n  </form>\n</template>\n\n<script setup>\nimport { ref, inject } from 'vue';\nimport { useRouter } from 'vue-router';\nimport useUserStore from '@/stores/user';\nimport TittleBlock from '@/components/TittleBlock.vue';\nimport { errorAlertConstruct } from '@/utils/alertConstructHandle';\n\nconst router = useRouter();\nconst axios = inject('axios');\nconst Swal = inject('$swal');\nconst isLoading = ref(false);\nconst form = ref(null);\nconst content = ref('');\nconst images = ref([]);\n\nconst userStore = useUserStore();\n\n// 貼文送出成功\nconst postSuccess = (title, text, path) => {\n  Swal.fire({\n    position: 'center',\n    icon: 'success',\n    title,\n    text,\n    showConfirmButton: false,\n    timer: 1500,\n  }).then(() => {\n    router.push(path);\n  });\n};\n\nconst createPost = () => {\n  if (images.value.length > 8) {\n    Swal.fire(errorAlertConstruct('失敗', '上傳圖片超過 8 張，請刪除圖片'));\n    return;\n  }\n\n  const data = {\n    user: userStore.user._id,\n    content: content.value,\n    image: images.value,\n    tags: ['出遊', '快樂的心情'],\n    type: 'person',\n  };\n  const url = `${process.env.VUE_APP_API}/post`;\n  isLoading.value = true;\n  axios\n    .post(url, data)\n    .then(() => {\n      form.value.reset();\n      isLoading.value = false;\n      postSuccess('貼文', '送出成功', '/');\n    })\n    .catch((err) => {\n      console.log(err);\n    });\n};\n\n// 上傳大頭照\nconst formFiles = ref(null);\nconst uploading = ref(false);\nconst uploadImages = () => {\n  // 未選擇圖片\n  if (formFiles.value.files.length === 0) {\n    return;\n  }\n  // 前端阻擋\n  if (formFiles.value.files.length > 8) {\n    Swal.fire(errorAlertConstruct('失敗', '上傳圖片超過 8 張，請重新上傳'));\n    form.value.reset();\n    return;\n  }\n\n  const formData = new FormData();\n  for (let i = 0; i < formFiles.value.files.length; i += 1) {\n    const file = formFiles.value.files[i];\n    formData.append('photos', file);\n  }\n\n  const url = `${process.env.VUE_APP_API}/upload/photos`;\n  const headers = {\n    'Content-Type': 'multipart/form-data',\n  };\n  uploading.value = true;\n  axios\n    .post(url, formData, { headers })\n    .then((res) => {\n      uploading.value = false;\n      images.value = [...images.value, ...res.data.data];\n    })\n    .catch((err) => {\n      uploading.value = false;\n      Swal.fire(errorAlertConstruct('失敗', err.response.data.message));\n    });\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.image {\n  &__card:hover {\n    img {\n      transition: all 0.5s;\n      filter: brightness(80%);\n    }\n  }\n  &__delete {\n    border-radius: 8px;\n    opacity: 0.5;\n    &:hover {\n      opacity: 1;\n    }\n  }\n}\n</style>\n","import script from \"./SendPost.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./SendPost.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./SendPost.vue?vue&type=style&index=0&id=67470892&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\Users\\\\peter.chen\\\\Documents\\\\myProject\\\\node直播班\\\\vue3-NFT-Social\\\\node_modules\\\\@vue\\\\cli-service\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-67470892\"]])\n\nexport default __exports__","import script from \"./TittleBlock.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./TittleBlock.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./TittleBlock.vue?vue&type=style&index=0&id=6333d894&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\Users\\\\peter.chen\\\\Documents\\\\myProject\\\\node直播班\\\\vue3-NFT-Social\\\\node_modules\\\\@vue\\\\cli-service\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6333d894\"]])\n\nexport default __exports__","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--1-1!./TittleBlock.vue?vue&type=style&index=0&id=6333d894&lang=scss&scoped=true\""],"sourceRoot":""}